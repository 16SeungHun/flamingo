# Frontend build pipeline

### Webpack

flamingo uses [webpack](https://webpack.js.org/) for packing frontend modules into a few bundled assets
which are then eventually served to the end-user.

The webpack configuration resides in `akl/frontend/build` and is separated into three files:

- `webpack.base.conf.js` (contains the base configuration)
- `webpack.development.conf.js` (inherits from base configuration and overrides it with development specific configuration)
- `webpack.production.conf.js` (inherits from base configuration and overrides it with production specific configuration)

webpack basically performs the following tasks:

- transpiling ES6 code (including .vue files) into ES5 code using babel
- compiling [Sass](http://sass-lang.com/) code into CSS
- creating source map files in development environment
- bundling all assets into minified production ready assets in production environment

### yarn

flamingo uses [yarn](https://yarnpkg.com) for frontend dependency management and as a task runner.
Please get familiar with yarn and especially with how it handles [dependency locking](https://yarnpkg.com/lang/en/docs/yarn-lock/).

### Main build tasks

After `cd`ing into the frontend folder you can execute all frontend build tasks using [npx](https://www.npmjs.com/package/npx) which is budled with npm@5.3 and greater.
You can list all available tasks with the following command:

```sh
npx flamingoHelp
```

#### `flamingoBuildAssets`

Creates dist directories and executes webpack using either development or production configuration.

#### `flamingoBuildTemplates`

Compiles [Pug](https://pugjs.org) source inside `akl/frontend/src/templates` folder and generates HTML files served by the dev-server,
as well as an abstract syntax tree (AST) which is used for the generation of Go-templates. Please get familiar with Pug.

#### `flamingoBuildStyleguide`

Generates a “living” styleguide from source.

#### `flamingoDev`

Starts the frontend development server, which serves the HTML files generated by the `build:templates` task.

#### `flamingoDevMockserver`

Same as dev, but with the environment variable `USE_MOCK_SERVER` set to `true`. See [mocking](#mocking).

## Mocking

For quick and independent frontend development flamingo offers a mocking concept.
You can write and register mock files in JSON and consume those inside the template files
respectively replicate in the backend. They kind of serve as “contract” between front- and backend.

The following schema exemplarily illustrates how the flamingo components work together within the scope of an MVC-design:

```
Product Controller (executes on a predefined route)       ┌────────────────→  Brand Block Contoller  ─────────┐
  |         |                                             |                             |                     |
  |   interacts with                                      |                       interacts with        returns data
  |         ↓                                             |                             ↓                     |
  |   Product Model  ────┐                          requests data                 Product Model  ────┐        |
  |                      |                                |                                          |        |
  |                     uses                              |                                         uses      |
  |                      |                                |                                          |        |
  └─────  calls  ────────|────→  Product View (Go-template generated from Pug-template)  ←───────────|────────┘
                         |                                                                           |
.........................|...........................................................................|..............
                         |                                                                           |
                         └───────────────────────→  mock data (JSON)  ←──────────────────────────────┘
                                                          ↑
                                                         uses
                                                          |
                                              Product View (Pug-template)

```


## Flamingo-Frontend Shared packages

There are shared dependencies.

If you work on them use:
```
npm version <major|minor|patch> && git push --follow-tags
```
to publish changes on this modules

And you can use `yarn link` to work locally on multiple packages:

1. Check out the shared package "packagename" and run the package build (`yarn`)
2. In the folder type "yarn link"
3. Go to your main flamingo frontend folder and type "yarn link packagename". As a result the node_modules folder should have a symlink to the local package checked out under 1. 
